function gobacktop(){var a=$("#topp").next();$("html,body").animate({scrollTop:"0px"},800),$(a).scrollTop(0)}function changePage(){if(null!=jsonPages)for(var a=0;a<jsonPages.length;a++){var b='<option value="'+jsonPages[a].resourceId+'">'+jsonPages[a].resourceName+"</option>";$("#pages_listId").append(b)}$("#auth_actionId").change(function(){var a=$("#auth_actionId option:selected").val();switch(a){case"auth_openpage":$("#auth_da_textId").parent("li").css("display","block"),$("#pages_listId").parent("li").css("display","none");break;case"auth_href":$("#pages_listId").parent("li").css("display","block"),$("#auth_da_textId").parent("li").css("display","none");break;case"auth_script":$("#auth_da_textId").parent("li").css("display","block"),$("#pages_listId").parent("li").css("display","none")}})}function createCode(){var a=generateCode(genHtml("\n	")),b='<pre class="brush: xml;">'+a+"</pre>";$("#code").append(b),$("#code").append('<a id="backTop" title="回到顶部" onclick="gobacktop();" class="backtop"><img src="images/top.png"  /></a>'),SyntaxHighlighter.highlight(),$("<div style='display:none' id='topp' name='topp'>x</div>").insertBefore(".syntaxhighlighter")}function generateAttrs(a){var b="",c=$(a).children().get(0).attributes;if(void 0!=c)for(var d=0;d<c.length;d++)att=c[d],att.specified&&(b+=att.name+'="'+att.value+'" ');return b}function genHtml(a){var b="",c="",d="",e={};return $(".phoneScreen").children("li").each(function(){var e=$(this).attr("id"),f="";if("headernav_type"==e)c=$(this).html();else if("hidden_type"==e)f=generateAttrs(this),b+='<li id="hidden_type" name="hidden_type" class="highlight hidden_bg"><input '+f+" /></li>"+a;else if("textarea_type"==e){var g=$(this).find("textarea").get(0).attributes;if(void 0!=g)for(var h=0;h<g.length;h++)att=g[h],att.specified&&(f+="isdisabled"==att.name&&"1"==att.value?' disabled="true" ':att.name+'="'+att.value+'" ');b+='<li id="textarea_type" name="textarea_type" class="highlight padding_left_right"><textarea '+f+"></textarea></li>"+a}else if("input_type"==e){var g=$(this).find("input").get(0).attributes;if(void 0!=g)for(var h=0;h<g.length;h++)att=g[h],att.specified&&(f+=att.name+'="'+att.value+'" ');b+='<li id="input_type" name="input_type" class="highlight padding_left_right"><input '+f+" /></li>"+a}else if("date_type"==e){var g=$(this).find("input").get(0).attributes;if(void 0!=g)for(var h=0;h<g.length;h++)att=g[h],att.specified&&(f+=att.name+'="'+att.value+'" ');b+='<li id="date_type" name="date_type" class="highlight padding_left_right"><input '+f+" /></li>"+a}else if("header_type"==e){var i=$(this).html(),j=$(this).attr("id"),k=$(this).attr("class");c='<li class="'+k+'" id="'+j+'" name="'+j+'">'+i+"</li>"+a}else if("footer_type"==e){var i=$(this).html(),j=$(this).attr("id"),k=$(this).attr("class");d='<li class="'+k+'" id="'+j+'" name="'+j+'">'+i+"</li>"+a}else{var i=$(this).html(),j=$(this).attr("id"),k=$(this).attr("class");b+='<li class="'+k+'" id="'+j+'" name="'+j+'">'+i+"</li>"+a}}),e.pageHeader=c,e.pageFooter=d,e.pageContent=b,e}function genTabHtml(a){var b="",c="",d="",e={};return $(".phoneScreen").children("li").each(function(){var e='<div id="tabs" data-role="header"',f=$("#tabs").get(0).attributes,g="";if(void 0!=f)for(var h=0;h<f.length;h++)att=f[h],att.specified&&"header-position"==att.name&&(g+=' data-position="'+att.value+'" ');$("#tabs div:eq(0)").removeClass().addClass("tab-nav-action"),$("#tabs div:gt(0)").removeClass().addClass("tab-nav"),e+=g+">"+$("#tabs").html()+"</div>";var i="",j="";$(this).find("style").each(function(){i+="<style>"+$(this).html()+"</style>"}),$(this).find("script").each(function(){j+=$(this).attr("id")?'<script id="'+$(this).attr("id")+'">'+$(this).html()+"</script>":"<script>"+$(this).html()+"</script>"}),b=e+i+j,c='<div data-role="footer"  data-position="fixed"><div class="ui-grid-a"><div class="ui-block-a"><a  data-role="button" id="yesNextBtn" class="tapButton" style="display: block;font-size:16px;">同意</a></div><div class="ui-block-b"><a data-role="button" id="noBtn" class="tapButton" style="display: block;font-size:16px;">不同意</a></div></div></div>';var k=[];$(this).find("#detailsContent ul").each(function(b){var c="",d="";c=0==b?'<div id="detailsContent"><ul class="tab" style="display:block;border-botton:1px solid #ccc;">':'<ul class="innerClass tab" style="display:none;border-botton:1px solid #ccc;">',$(this).find(">li").each(function(){var b=$(this).attr("id"),c="";if("hidden_type"==b)c=generateAttrs(this),d+='<li id="hidden_type" name="hidden_type" class="highlight hidden_bg"><input '+c+" /></li>"+a;else if("textarea_type"==b){var e=$(this).find("textarea").get(0).attributes;if(void 0!=e)for(var f=0;f<e.length;f++)att=e[f],att.specified&&("isdisabled"==att.name&&"1"==att.value?(c+=' disabled="true" ',c+='style="color:#000;font-weight:bolder;"'):c+=att.name+'="'+att.value+'" ');d+='<li id="textarea_type" name="textarea_type" class="highlight padding_left_right"><textarea '+c+"></textarea></li>"+a}else if("input_type"==b){var e=$(this).find("input").get(0).attributes;if(void 0!=e)for(var f=0;f<e.length;f++)att=e[f],att.specified&&(c+=att.name+'="'+att.value+'" ');d+='<li id="input_type" name="input_type" class="highlight padding_left_right"><input '+c+" /></li>"+a}else if("date_type"==b){var e=$(this).find("input").get(0).attributes;if(void 0!=e)for(var f=0;f<e.length;f++)att=e[f],att.specified&&(c+=att.name+'="'+att.value+'" ');d+='<li id="date_type" name="date_type" class="highlight padding_left_right"><input '+c+" /></li>"+a}else if("footerLi"==b);else{var g=$(this).html(),h=$(this).attr("id"),i=$(this).attr("class");d+='<li class="'+i+'" id="'+h+'" name="'+h+'">'+g+"</li>"+a}}),c+=d+"</ul>",k[b]=c}),d+=k[0]+k[1]+k[2]+"</div>"}),e.pageHeader=b,e.pageFooter=c,e.pageContent=d,e}function generatePage(a){var b="<div id='page_protocol' style='display:none'>"+$.trim($("#reqMsgs").val())+"</div><div id='skinId' style='display:none'>"+$.trim($(".phoneGray").attr("id"))+"</div><div id='pageType' style='display:none'>"+$.trim($("#pageType").val())+"</div><div id='cssTemplateName' style='display:none'>"+$.trim($("#cssTemplateName").val())+"</div>",c='<form id="pageForm"><div data-role="page" id="page">',d="";return c+=a.pageHeader,d='<div id="page_content1" data-role="content"><ul id="details" style="position: relative;" class="phoneScreen vertical">'+a.pageContent+"</ul>",d+=b,d+="</div>",c+=d,c+=a.pageFooter,c+="</div>",c+="</form>"}function generateCode(a){var b="<div id='page_protocol' style='display:none'>\n	"+$.trim($("#reqMsgs").val())+"</div>\n	<div id='skinId' style='display:none'>"+$.trim($(".phoneGray").attr("id"))+"</div>\n	<div id='pageType' style='display:none'>\n	"+$.trim($("#pageType").val())+"</div>\n	<div id='cssTemplateName' style='display:none'>\n	"+$.trim($("#cssTemplateName").val())+"</div>\n	",c='<div data-role="page" id="page">\n	<form id="pageForm">\n	',d="";return c+=a.pageHeader,d='<div id="page_content1" data-role="content">\n	<ul id="details" style="position: relative;" class="phoneScreen vertical ui-content">\n	'+a.pageContent+"</ul>\n	",d+=b,d+="</div>\n	",c+=d,c+="</form>\n	",c+=a.pageFooter,c+="</div>"}function changeStyle(a){$(".phoneGray").attr("id",a)}function openDialog(a,b,c,d,e){var f=$.layer({type:2,title:a,iframe:{src:b},border:[4,1,"#DBD9D9",!0],area:[c,d],offset:["80px",""],close:function(a){layer.close(a)},success:function(){$(".xubox_layer").attr("iframe_menuId",e)}});return f}function createSortScript(){var a="$('ul.phoneScreen').sortable({group : 'no-drop',onDragStart : function(item, container, _super) {var id = $(item).attr('id');if (!container.options.drop) {var html = MoblieEditor.buildHtml(id, item);item.html(html);$.mobile.pageContainer.trigger('create');}_super(item);}});",b="$('ul.cpList').sortable({group: 'no-drop',drop: false})",c="<script>$(function(){"+a+"})</script>",d="<script>$(function(){"+b+"})</script>";$("#script").html(""),$("#script").append(c).append(d)}function loadTree(a){var b=null;$.ajax({async:!1,cache:!1,type:"POST",dataType:"json",url:"laodModuleTree?pageType="+a,error:function(){alert("请求失败")},success:function(a){b=a}}),$.fn.zTree.init($("#tree"),setting,b)}function treeClick(a,b,c){$.post("laodModulePage",{serviceId:$("#serviceId").val(),pid:c.id},function(a){$("#details").empty(),$("#details").append(a.html),$("#reqMsgs").html(a.protocol),$("#templateId").val(a.templateId),$("#cssTemplateName").val(a.cssTemplateName),$("#jsMsgs").val(a.jsContent),$("#jsMsgs").html(a.jsContent),$.mobile.pageContainer.trigger("create"),layer.close(index)},"json")}function addStyle(a){$("#"+a).html(""),$("#"+a).html(CKEDITOR.instances.editor1.getData())}function uploadImg(){return""==$("#auth_imageId_file").val()?(alert("上传文件不能为空!"),!1):void $.ajaxFileUpload({url:"upload",secureuri:!1,fileElementId:"auth_imageId_file",dataType:"json",success:function(a){return""==a.fileName?!1:void $("img[id^=m_listView_img]").attr("src","readImage?imagePath="+a.fileName)},error:function(){}})}function isRepeat(a){var b={},c={flag:!1,repeat:""};for(var d in a){if(b[a[d]])return c.flag=!0,c.repeat=a[d],c;b[a[d]]=!0}return c}sessionStorage.clear();var index,jsonPages=null,show=0,$defaultMode=$(".mode li").eq(show).addClass("hover");$($defaultMode.find("a").attr("name")).show().siblings().hide(),$(".mode li").click(function(){$(this).addClass("hover").siblings().removeClass("hover");var a=$(this).find("a").attr("name");return $(a).show().siblings().hide(),".codeMode"==a&&$("#backTop").css("display","block"),!1}).find("a").focus(function(){this.blur()}),$("#design").click(function(){var a=$("#codeMode").html();$("#tmp").html(a)}),$("#savePage").click(function(){var a=$("#pageType").val(),b="";"blank"==a?b=genHtml(""):"tab"==a&&(b=genTabHtml("")),gHtml=generatePage(b),layer.confirm("保存后会关闭当前页面，是否确定保存？",function(a){$.post("toAddRaw",{rawHtml:gHtml,serviceId:$("#serviceId").val(),resourceName:$("#fileName").val(),jsId:$("#jsMsgs").val(),templateId:$("#templateId").val(),responseProtocol:$("#ansMsgs").val()},function(){$(".phoneScreen").empty(),layer.close(a),window.opener.refreshPage(),window.close()})})}),$("#uploadJsBtn").click(function(){return""==$("#file").val()?(alert("上传文件不能为空!"),!1):void $.ajaxFileUpload({url:"upload",secureuri:!1,fileElementId:"file",dataType:"json",success:function(a){return""==a.fileName?!1:($("#jsId").val(a.fileName),void layer.close(index))},error:function(){}})}),$("#cancelPage").click(function(){layer.close(index)}),$("#cancelUploadBtn").click(function(){layer.close(index)}),$("#fo_creat").click(function(){for(var a=$("[auth_data]"),b=!1,c=new Array,d=0;d<a.length;d++){var e=a[d].getAttribute("auth_data");e=e.replace(/[ ]/g,""),""==e||" "==e?(c.push(a[d]),b=!0):a[d].removeAttribute("style")}if(b){layer.alert("绑定ID不能为空",8);for(var d=0;d<c.length;d++){var f=$(c[d]);f.css({color:"#F00",border:"1px solid #F00"})}}else $("#fileName").val(""),index=$.layer({type:1,area:["300px","130px"],title:"保存页面",closeBtn:[0,!0],page:{dom:"#add"}})}),$("#fo_presure").click(function(){$(".phoneScreen").html();openDialog("预览","preview",700,600)}),$(".phoneScreen").on("mouseenter mouseup",".highlight",function(a){"mouseup"==a.type&&$("<img class='delete' src='images/icon_remove.png'>").appendTo(this),"mouseenter"==a.type&&$("<img class='delete' src='images/icon_remove.png'>").appendTo(this)}).on("mouseleave",".highlight",function(){$(".delete, .forbidden").remove()}).on("mousedown",".forbidden",function(){$(".delete").remove()}).on("click",".highlight",function(){$(this).addClass("hover").siblings().removeClass("hover")}),$(".phoneScreen").on("click",".delete",function(){$(this).parent().remove()});var setting={data:{simpleData:{enable:!0}},callback:{onClick:treeClick}};$("#fo_redo").click(function(){index=$.layer({type:1,area:["300px","auto"],title:"选择模板",closeBtn:[0,!0],page:{dom:"#loadModule"}}),$("#contentAttrs").empty()}),$("#fo_uploadJs").click(function(){var a=document.getElementById("file");a.outerHTML=a.outerHTML,index=$.layer({type:1,area:["300px","auto"],title:"选择模板",closeBtn:[0,!0],page:{dom:"#uploadJs"}})}),$("#fo_clear").click(function(){$("#details").empty(),$("#contentAttrs").empty()});var currentPage=document.location.href;currentPage.indexOf("toNewRawResourcePage")>0?index=$.layer({type:1,area:["300px","330px"],title:"新建页面向导",closeBtn:[0,!1],page:{dom:"#decorationDiv"}}):"blank"==$("#pageType").val()?(createSortScript(),loadTree("blank")):"tab"==$("#pageType").val()&&(loadTree("tab"),$("#script").html("")),$("#decorationDiv div").each(function(){$(this).bind("click",function(){var a=$(this).attr("pageType");"blank"==a?($("#pageType").val(a),createSortScript(),loadTree("blank")):"tab"==a&&($("#pageType").val(a),loadTree("tab"),$("#script").html("")),layer.close(index)})}),$("#cancelDecorationBtn").click(function(){layer.close(index)}),jQuery.extend({createUploadIframe:function(a,b){var c="jUploadFrame"+a,d='<iframe id="'+c+'" name="'+c+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&("boolean"==typeof b?d+=' src="javascript:false"':"string"==typeof b&&(d+=' src="'+b+'"')),d+=" />",jQuery(d).appendTo(document.body),jQuery("#"+c).get(0)},createUploadForm:function(a,b,c){var d="jUploadForm"+a,e="jUploadFile"+a,f=jQuery('<form  action="" method="POST" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');if(c)for(var g in c)jQuery('<input type="hidden" name="'+g+'" value="'+c[g]+'" />').appendTo(f);var h=jQuery("#"+b),i=jQuery(h).clone();return jQuery(h).attr("id",e),jQuery(h).before(i),jQuery(h).appendTo(f),jQuery(f).css("position","absolute"),jQuery(f).css("top","-1200px"),jQuery(f).css("left","-1200px"),jQuery(f).appendTo("body"),f},handleError:function(a,b,c,d){a.error&&a.error.call(a.context||a,b,c,d),a.global&&(a.context?jQuery(a.context):jQuery.event).trigger("ajaxError",[b,a,d])},ajaxFileUpload:function(a){a=jQuery.extend({},jQuery.ajaxSettings,a);var b=(new Date).getTime(),c=jQuery.createUploadForm(b,a.fileElementId,"undefined"==typeof a.data?!1:a.data),d=(jQuery.createUploadIframe(b,a.secureuri),"jUploadFrame"+b),e="jUploadForm"+b;a.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var f=!1,g={};a.global&&jQuery.event.trigger("ajaxSend",[g,a]);var h=function(b){var e=document.getElementById(d);try{e.contentWindow?(g.responseText=e.contentWindow.document.body?e.contentWindow.document.body.innerHTML:null,g.responseXML=e.contentWindow.document.XMLDocument?e.contentWindow.document.XMLDocument:e.contentWindow.document):e.contentDocument&&(g.responseText=e.contentDocument.document.body?e.contentDocument.document.body.innerHTML:null,g.responseXML=e.contentDocument.document.XMLDocument?e.contentDocument.document.XMLDocument:e.contentDocument.document)}catch(h){jQuery.handleError(a,g,null,h)}if(g||"timeout"==b){f=!0;var i;try{if(i="timeout"!=b?"success":"error","error"!=i){var j=jQuery.uploadHttpData(g,a.dataType);a.success&&a.success(j,i),a.global&&jQuery.event.trigger("ajaxSuccess",[g,a])}else jQuery.handleError(a,g,i)}catch(h){i="error",jQuery.handleError(a,g,i,h)}a.global&&jQuery.event.trigger("ajaxComplete",[g,a]),a.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),a.complete&&a.complete(g,i),jQuery(e).unbind(),setTimeout(function(){try{jQuery(e).remove(),jQuery(c).remove()}catch(b){jQuery.handleError(a,g,null,b)}},100),g=null}};a.timeout>0&&setTimeout(function(){f||h("timeout")},a.timeout);try{var c=jQuery("#"+e);jQuery(c).attr("action",a.url),jQuery(c).attr("method","POST"),jQuery(c).attr("target",d),c.encoding?jQuery(c).attr("encoding","multipart/form-data"):jQuery(c).attr("enctype","multipart/form-data"),jQuery(c).submit()}catch(i){jQuery.handleError(a,g,null,i)}return jQuery("#"+d).load(h),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;if(data="xml"==type||data?r.responseXML:r.responseText,data=data.replace("<pre>",""),data=data.replace("</pre>",""),"script"==type&&jQuery.globalEval(data),"json"==type){data=r.responseText;var start=data.indexOf(">");if(-1!=start){var end=data.indexOf("<",start+1);-1!=end&&(data=data.substring(start+1,end))}eval("data = "+data)}return"html"==type&&jQuery("<div>").html(data).evalScripts(),data}});